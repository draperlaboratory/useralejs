!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.userale=t.userale||{})}(this,function(t){"use strict";function e(t){if(t.timeStamp&&t.timeStamp>0){var e,n=Date.now()-t.timeStamp;if(n<0)e=function(){return t.timeStamp/1e3};else if(n>t.timeStamp){var o=performance.timing.navigationStart;e=function(t){return t+o}}else e=function(t){return t}}else e=function(){return Date.now()};return e}function n(t,e){Object.keys(e).forEach(function(n){if("userFromParams"===n){var r=o(e[n]);r&&(t.userId=r)}t[n]=e[n]})}function o(t){var e=t,n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=window.location.href.match(n);return o&&o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):null}function r(t,e){if(!E.on)return!1;var n=null;e&&(n=e(t));var o={target:l(t.target),path:u(t),clientTime:Math.floor(t.timeStamp&&t.timeStamp>0?E.time(t.timeStamp):Date.now()),location:a(t),type:t.type,userAction:!0,details:n,userId:E.userId,toolVersion:E.version,toolName:E.toolName,useraleVersion:E.useraleVersion};return K.push(o),!0}function a(t){return null!=t.pageX?{x:t.pageX,y:t.pageY}:null!=t.clientX?{x:document.documentElement.scrollLeft+t.clientX,y:document.documentElement.scrollTop+t.clientY}:{x:null,y:null}}function l(t){return t.localName?t.localName+(t.id?"#"+t.id:"")+(t.className?"."+t.className:""):t.nodeName?t.nodeName+(t.id?"#"+t.id:"")+(t.className?"."+t.className:""):t&&t.document&&t.location&&t.alert&&t.setInterval?"Window":"Unknown"}function u(t){var e=[];if(t.path)e=t.path;else for(var n=t.target;n;)e.push(n),n=n.parentElement;return i(e)}function i(t){for(var e,n=0,o=[];e=t[n];)o.push(l(e)),++n;return o}function c(t){S={click:function(t){return{clicks:t.detail,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey}},dblclick:function(t){return{clicks:t.detail,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey}},mousedown:function(t){return{clicks:t.detail,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey}},mouseup:function(t){return{clicks:t.detail,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey}},focus:null,blur:null,input:t.logDetails?function(t){return{value:t.target.value}}:null,change:t.logDetails?function(t){return{value:t.target.value}}:null,dragstart:null,dragend:null,drag:null,drop:null,keydown:t.logDetails?function(t){return{key:t.keyCode,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey}}:null,mouseover:null,submit:null},N={},b={wheel:function(t){return{x:t.deltaX,y:t.deltaY,z:t.deltaZ}},scroll:function(){return{x:window.scrollX,y:window.scrollY}},resize:function(){return{width:window.outerWidth,height:window.outerHeight}}},k=["load","blur","focus"]}function s(t){return c(t),Object.keys(S).forEach(function(t){document.addEventListener(t,function(e){r(e,S[t])},!0)}),Object.keys(b).forEach(function(e){N[e]=!0,window.addEventListener(e,function(n){N[e]&&(N[e]=!1,r(n,b[e]),setTimeout(function(){N[e]=!0},t.resolution))},!0)}),k.forEach(function(t){window.addEventListener(t,function(t){r(t,function(){return{window:!0}})},!0)}),!0}function d(t,e){f(t,e),m(t,e)}function f(t,e){setInterval(function(){t.length>=e.logCountThreshold&&(p(t.slice(0),e.url,0),t.splice(0))},e.transmitInterval)}function m(t,e){navigator.sendBeacon?window.addEventListener("unload",function(){navigator.sendBeacon(e.url,JSON.stringify(t))}):window.addEventListener("beforeunload",function(){t.length>0&&p(t,e.url,1)})}function p(t,e,n){var o=new XMLHttpRequest,r=JSON.stringify(t);o.open("POST",e),o.setRequestHeader("Content-type","application/json;charset=UTF-8"),o.onreadystatechange=function(){4===o.readyState&&200!==o.status&&n>0&&p(t,e,n--)},o.send(r)}function h(e){t.started||setTimeout(function(){var n=document.readyState;"interactive"===n||"complete"===n?(s(e),d(I,e),t.started=e.on=!0):h(e)},100)}function y(){t.started||h(x),x.on=!0}function v(){x.on=!1}function g(t){return void 0!==t&&n(x,t),x}function w(t){return null!==t&&"object"==typeof t&&(I.push(t),!0)}var K,E,S,N,b,k,x={},I=[];t.started=!1,x.on=!1,x.useraleVersion="0.2.1",n(x,function(){var t={},n=document.currentScript||function(){var t=document.getElementsByTagName("script");return t[t.length-1]}(),o=n?n.getAttribute.bind(n):function(){return null};return t.autostart="false"!==o("data-autostart"),t.url=o("data-url")||"http://localhost:8000",t.transmitInterval=+o("data-interval")||5e3,t.logCountThreshold=+o("data-threshold")||5,t.userId=o("data-user")||null,t.version=o("data-version")||null,t.logDetails="true"===o("data-log-details"),t.resolution=+o("data-resolution")||500,t.toolName=o("data-tool")||null,t.userFromParams=o("data-user-from-params")||null,t.time=e(document.createEvent("CustomEvent")),t}()),function(t,e){K=t,E=e}(I,x),x.autostart&&h(x);t.version="0.2.1",t.start=y,t.stop=v,t.options=g,t.log=w,Object.defineProperty(t,"__esModule",{value:!0})});